{"ast":null,"code":"import React,{useState,useEffect}from'react';import{TrendingUp,TrendingDown,Activity}from'lucide-react';import{fetchTrendData}from'../services/trendApi';import TrendModal from'./TrendModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const TrendIndicator=_ref=>{let{locationId,locationName,metric,metricDisplayName,currentValue,target,className=''}=_ref;const[trend,setTrend]=useState('stable');const[showModal,setShowModal]=useState(false);const[loading,setLoading]=useState(false);const[hasData,setHasData]=useState(false);useEffect(()=>{if(locationId&&metric){fetchTrendStatus();}},[locationId,metric]);const fetchTrendStatus=async()=>{setLoading(true);try{// Ensure metric name is passed exactly as received - no transformation\nconsole.log(\"TrendIndicator: Fetching trend for \".concat(locationId,\"/\").concat(metric));const response=await fetchTrendData(locationId,metric,6);if(response.success&&response.data&&response.data.monthsOfData>=2){setTrend(response.data.trend);setHasData(true);console.log(\"TrendIndicator: Got trend data for \".concat(metric,\": \").concat(response.data.trend));}else{setTrend('stable');setHasData(false);console.log(\"TrendIndicator: No sufficient data for \".concat(metric,\", setting stable\"));}}catch(error){console.error(\"TrendIndicator: Error fetching trend status for \".concat(metric,\":\"),error);setTrend('stable');setHasData(false);}finally{setLoading(false);}};const handleClick=()=>{setShowModal(true);};const getTrendDisplayText=()=>{if(!hasData)return'New Data';return trend.charAt(0).toUpperCase()+trend.slice(1);};const getTrendButtonClass=()=>{const baseClass='flex items-center space-x-1 text-sm font-medium px-2 py-1 rounded-md transition-all duration-200 cursor-pointer hover:opacity-80 hover:scale-105';if(!hasData){return\"\".concat(baseClass,\" bg-gray-500/20 text-gray-400 border border-gray-500/30\");}switch(trend){case'improving':return\"\".concat(baseClass,\" bg-green-500/20 text-green-400 border border-green-500/30\");case'declining':return\"\".concat(baseClass,\" bg-red-500/20 text-red-400 border border-red-500/30\");case'stable':return\"\".concat(baseClass,\" bg-blue-500/20 text-blue-400 border border-blue-500/30\");default:return\"\".concat(baseClass,\" bg-gray-500/20 text-gray-400 border border-gray-500/30\");}};const getTrendIconComponent=()=>{if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 animate-spin rounded-full border-2 border-current border-t-transparent\"});}if(!hasData){return/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4\"});}switch(trend){case'improving':return/*#__PURE__*/_jsx(TrendingUp,{className:\"w-4 h-4\"});case'declining':return/*#__PURE__*/_jsx(TrendingDown,{className:\"w-4 h-4\"});case'stable':return/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4\"});default:return/*#__PURE__*/_jsx(Activity,{className:\"w-4 h-4\"});}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleClick,className:\"\".concat(getTrendButtonClass(),\" \").concat(className),title:hasData?\"Click to view detailed trend analysis\":\"Not enough data for trend analysis\",disabled:loading,children:[getTrendIconComponent(),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:getTrendDisplayText()})]}),showModal&&/*#__PURE__*/_jsx(TrendModal,{isOpen:showModal,onClose:()=>setShowModal(false),locationId:locationId,locationName:locationName,metric:metric,metricDisplayName:metricDisplayName,target:target})]});};export default TrendIndicator;","map":{"version":3,"names":["React","useState","useEffect","TrendingUp","TrendingDown","Activity","fetchTrendData","TrendModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TrendIndicator","_ref","locationId","locationName","metric","metricDisplayName","currentValue","target","className","trend","setTrend","showModal","setShowModal","loading","setLoading","hasData","setHasData","fetchTrendStatus","console","log","concat","response","success","data","monthsOfData","error","handleClick","getTrendDisplayText","charAt","toUpperCase","slice","getTrendButtonClass","baseClass","getTrendIconComponent","children","onClick","title","disabled","isOpen","onClose"],"sources":["C:/Users/michaela/service-management-app/frontend/src/components/TrendIndicator.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { TrendingUp, TrendingDown, Activity } from 'lucide-react';\r\nimport { fetchTrendData, getTrendIcon, getTrendColorClass } from '../services/trendApi';\r\nimport TrendModal from './TrendModal';\r\n\r\ninterface TrendIndicatorProps {\r\n  locationId: string;\r\n  locationName: string;\r\n  metric: string;\r\n  metricDisplayName: string;\r\n  currentValue: string;\r\n  target?: string;\r\n  className?: string;\r\n}\r\n\r\nconst TrendIndicator: React.FC<TrendIndicatorProps> = ({\r\n  locationId,\r\n  locationName,\r\n  metric,\r\n  metricDisplayName,\r\n  currentValue,\r\n  target,\r\n  className = ''\r\n}) => {\r\n  const [trend, setTrend] = useState<'improving' | 'declining' | 'stable'>('stable');\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [hasData, setHasData] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (locationId && metric) {\r\n      fetchTrendStatus();\r\n    }\r\n  }, [locationId, metric]);\r\n\r\n  const fetchTrendStatus = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Ensure metric name is passed exactly as received - no transformation\r\n      console.log(`TrendIndicator: Fetching trend for ${locationId}/${metric}`);\r\n      \r\n      const response = await fetchTrendData(locationId, metric, 6);\r\n      \r\n      if (response.success && response.data && response.data.monthsOfData >= 2) {\r\n        setTrend(response.data.trend);\r\n        setHasData(true);\r\n        console.log(`TrendIndicator: Got trend data for ${metric}: ${response.data.trend}`);\r\n      } else {\r\n        setTrend('stable');\r\n        setHasData(false);\r\n        console.log(`TrendIndicator: No sufficient data for ${metric}, setting stable`);\r\n      }\r\n    } catch (error) {\r\n      console.error(`TrendIndicator: Error fetching trend status for ${metric}:`, error);\r\n      setTrend('stable');\r\n      setHasData(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClick = () => {\r\n    setShowModal(true);\r\n  };\r\n\r\n  const getTrendDisplayText = (): string => {\r\n    if (!hasData) return 'New Data';\r\n    return trend.charAt(0).toUpperCase() + trend.slice(1);\r\n  };\r\n\r\n  const getTrendButtonClass = (): string => {\r\n    const baseClass = 'flex items-center space-x-1 text-sm font-medium px-2 py-1 rounded-md transition-all duration-200 cursor-pointer hover:opacity-80 hover:scale-105';\r\n    \r\n    if (!hasData) {\r\n      return `${baseClass} bg-gray-500/20 text-gray-400 border border-gray-500/30`;\r\n    }\r\n    \r\n    switch (trend) {\r\n      case 'improving':\r\n        return `${baseClass} bg-green-500/20 text-green-400 border border-green-500/30`;\r\n      case 'declining':\r\n        return `${baseClass} bg-red-500/20 text-red-400 border border-red-500/30`;\r\n      case 'stable':\r\n        return `${baseClass} bg-blue-500/20 text-blue-400 border border-blue-500/30`;\r\n      default:\r\n        return `${baseClass} bg-gray-500/20 text-gray-400 border border-gray-500/30`;\r\n    }\r\n  };\r\n\r\n  const getTrendIconComponent = () => {\r\n    if (loading) {\r\n      return <div className=\"w-4 h-4 animate-spin rounded-full border-2 border-current border-t-transparent\" />;\r\n    }\r\n    \r\n    if (!hasData) {\r\n      return <Activity className=\"w-4 h-4\" />;\r\n    }\r\n    \r\n    switch (trend) {\r\n      case 'improving':\r\n        return <TrendingUp className=\"w-4 h-4\" />;\r\n      case 'declining':\r\n        return <TrendingDown className=\"w-4 h-4\" />;\r\n      case 'stable':\r\n        return <Activity className=\"w-4 h-4\" />;\r\n      default:\r\n        return <Activity className=\"w-4 h-4\" />;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        onClick={handleClick}\r\n        className={`${getTrendButtonClass()} ${className}`}\r\n        title={hasData ? \"Click to view detailed trend analysis\" : \"Not enough data for trend analysis\"}\r\n        disabled={loading}\r\n      >\r\n        {getTrendIconComponent()}\r\n        <span className=\"text-xs\">{getTrendDisplayText()}</span>\r\n      </button>\r\n\r\n      {showModal && (\r\n        <TrendModal\r\n          isOpen={showModal}\r\n          onClose={() => setShowModal(false)}\r\n          locationId={locationId}\r\n          locationName={locationName}\r\n          metric={metric}\r\n          metricDisplayName={metricDisplayName}\r\n          target={target}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default TrendIndicator;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,UAAU,CAAEC,YAAY,CAAEC,QAAQ,KAAQ,cAAc,CACjE,OAASC,cAAc,KAA0C,sBAAsB,CACvF,MAAO,CAAAC,UAAU,KAAM,cAAc,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAYtC,KAAM,CAAAC,cAA6C,CAAGC,IAAA,EAQhD,IARiD,CACrDC,UAAU,CACVC,YAAY,CACZC,MAAM,CACNC,iBAAiB,CACjBC,YAAY,CACZC,MAAM,CACNC,SAAS,CAAG,EACd,CAAC,CAAAP,IAAA,CACC,KAAM,CAACQ,KAAK,CAAEC,QAAQ,CAAC,CAAGvB,QAAQ,CAAuC,QAAQ,CAAC,CAClF,KAAM,CAACwB,SAAS,CAAEC,YAAY,CAAC,CAAGzB,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC0B,OAAO,CAAEC,UAAU,CAAC,CAAG3B,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAAC4B,OAAO,CAAEC,UAAU,CAAC,CAAG7B,QAAQ,CAAC,KAAK,CAAC,CAE7CC,SAAS,CAAC,IAAM,CACd,GAAIc,UAAU,EAAIE,MAAM,CAAE,CACxBa,gBAAgB,CAAC,CAAC,CACpB,CACF,CAAC,CAAE,CAACf,UAAU,CAAEE,MAAM,CAAC,CAAC,CAExB,KAAM,CAAAa,gBAAgB,CAAG,KAAAA,CAAA,GAAY,CACnCH,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACF;AACAI,OAAO,CAACC,GAAG,uCAAAC,MAAA,CAAuClB,UAAU,MAAAkB,MAAA,CAAIhB,MAAM,CAAE,CAAC,CAEzE,KAAM,CAAAiB,QAAQ,CAAG,KAAM,CAAA7B,cAAc,CAACU,UAAU,CAAEE,MAAM,CAAE,CAAC,CAAC,CAE5D,GAAIiB,QAAQ,CAACC,OAAO,EAAID,QAAQ,CAACE,IAAI,EAAIF,QAAQ,CAACE,IAAI,CAACC,YAAY,EAAI,CAAC,CAAE,CACxEd,QAAQ,CAACW,QAAQ,CAACE,IAAI,CAACd,KAAK,CAAC,CAC7BO,UAAU,CAAC,IAAI,CAAC,CAChBE,OAAO,CAACC,GAAG,uCAAAC,MAAA,CAAuChB,MAAM,OAAAgB,MAAA,CAAKC,QAAQ,CAACE,IAAI,CAACd,KAAK,CAAE,CAAC,CACrF,CAAC,IAAM,CACLC,QAAQ,CAAC,QAAQ,CAAC,CAClBM,UAAU,CAAC,KAAK,CAAC,CACjBE,OAAO,CAACC,GAAG,2CAAAC,MAAA,CAA2ChB,MAAM,oBAAkB,CAAC,CACjF,CACF,CAAE,MAAOqB,KAAK,CAAE,CACdP,OAAO,CAACO,KAAK,oDAAAL,MAAA,CAAoDhB,MAAM,MAAKqB,KAAK,CAAC,CAClFf,QAAQ,CAAC,QAAQ,CAAC,CAClBM,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,OAAS,CACRF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAY,WAAW,CAAGA,CAAA,GAAM,CACxBd,YAAY,CAAC,IAAI,CAAC,CACpB,CAAC,CAED,KAAM,CAAAe,mBAAmB,CAAGA,CAAA,GAAc,CACxC,GAAI,CAACZ,OAAO,CAAE,MAAO,UAAU,CAC/B,MAAO,CAAAN,KAAK,CAACmB,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAAGpB,KAAK,CAACqB,KAAK,CAAC,CAAC,CAAC,CACvD,CAAC,CAED,KAAM,CAAAC,mBAAmB,CAAGA,CAAA,GAAc,CACxC,KAAM,CAAAC,SAAS,CAAG,kJAAkJ,CAEpK,GAAI,CAACjB,OAAO,CAAE,CACZ,SAAAK,MAAA,CAAUY,SAAS,4DACrB,CAEA,OAAQvB,KAAK,EACX,IAAK,WAAW,CACd,SAAAW,MAAA,CAAUY,SAAS,+DACrB,IAAK,WAAW,CACd,SAAAZ,MAAA,CAAUY,SAAS,yDACrB,IAAK,QAAQ,CACX,SAAAZ,MAAA,CAAUY,SAAS,4DACrB,QACE,SAAAZ,MAAA,CAAUY,SAAS,4DACvB,CACF,CAAC,CAED,KAAM,CAAAC,qBAAqB,CAAGA,CAAA,GAAM,CAClC,GAAIpB,OAAO,CAAE,CACX,mBAAOlB,IAAA,QAAKa,SAAS,CAAC,gFAAgF,CAAE,CAAC,CAC3G,CAEA,GAAI,CAACO,OAAO,CAAE,CACZ,mBAAOpB,IAAA,CAACJ,QAAQ,EAACiB,SAAS,CAAC,SAAS,CAAE,CAAC,CACzC,CAEA,OAAQC,KAAK,EACX,IAAK,WAAW,CACd,mBAAOd,IAAA,CAACN,UAAU,EAACmB,SAAS,CAAC,SAAS,CAAE,CAAC,CAC3C,IAAK,WAAW,CACd,mBAAOb,IAAA,CAACL,YAAY,EAACkB,SAAS,CAAC,SAAS,CAAE,CAAC,CAC7C,IAAK,QAAQ,CACX,mBAAOb,IAAA,CAACJ,QAAQ,EAACiB,SAAS,CAAC,SAAS,CAAE,CAAC,CACzC,QACE,mBAAOb,IAAA,CAACJ,QAAQ,EAACiB,SAAS,CAAC,SAAS,CAAE,CAAC,CAC3C,CACF,CAAC,CAED,mBACEX,KAAA,CAAAE,SAAA,EAAAmC,QAAA,eACErC,KAAA,WACEsC,OAAO,CAAET,WAAY,CACrBlB,SAAS,IAAAY,MAAA,CAAKW,mBAAmB,CAAC,CAAC,MAAAX,MAAA,CAAIZ,SAAS,CAAG,CACnD4B,KAAK,CAAErB,OAAO,CAAG,uCAAuC,CAAG,oCAAqC,CAChGsB,QAAQ,CAAExB,OAAQ,CAAAqB,QAAA,EAEjBD,qBAAqB,CAAC,CAAC,cACxBtC,IAAA,SAAMa,SAAS,CAAC,SAAS,CAAA0B,QAAA,CAAEP,mBAAmB,CAAC,CAAC,CAAO,CAAC,EAClD,CAAC,CAERhB,SAAS,eACRhB,IAAA,CAACF,UAAU,EACT6C,MAAM,CAAE3B,SAAU,CAClB4B,OAAO,CAAEA,CAAA,GAAM3B,YAAY,CAAC,KAAK,CAAE,CACnCV,UAAU,CAAEA,UAAW,CACvBC,YAAY,CAAEA,YAAa,CAC3BC,MAAM,CAAEA,MAAO,CACfC,iBAAiB,CAAEA,iBAAkB,CACrCE,MAAM,CAAEA,MAAO,CAChB,CACF,EACD,CAAC,CAEP,CAAC,CAED,cAAe,CAAAP,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}